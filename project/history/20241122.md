# Next.jsプロジェクトにTypeScriptを追加する
## TypeScriptの依存関係を確認
`npm list typescript`
```
nameMacBook-Pro project % npm list typescript
next-project@0.1.0 /Users/name_1/Desktop/_workspace_tec/workspace_React-todo_1/React-todo_1/project
└── typescript@5.6.3 extraneous

nameMacBook-Pro project % 

```
TypeScriptはインストールされているようですが、"extraneous"（不要な）としてマークされています。これはpackage.jsonに正しく登録されていない状態です。
再度インストールを実行してください：

# Next.jsプロジェクトにTypeScriptを追加する
```
nameMacBook-Pro project % npm install --save-dev typescript @types/react @types/node @types/react-dom

up to date, audited 149 packages in 2s

35 packages are looking for funding
  run `npm fund` for details

2 high severity vulnerabilities

To address issues that do not require attention, run:
  npm audit fix

To address all issues, run:
  npm audit fix --force

Run `npm audit` for details.
nameMacBook-Pro project % 
```
# インストール後、tsconfig.jsonを作成する
`npx tsc --init `
```
nameMacBook-Pro project % npm tsc --init
Unknown command: "tsc"

To see a list of supported npm commands, run:
  npm help
nameMacBook-Pro project % npx tsc --init                                                             

Created a new tsconfig.json with:                                                                                       
                                                                                                                     TS 
  target: es2016
  module: commonjs
  strict: true
  esModuleInterop: true
  skipLibCheck: true
  forceConsistentCasingInFileNames: true


You can learn more at https://aka.ms/tsconfig
nameMacBook-Pro project % 
```
- npxはパッケージの実行に特化したツールで、ローカルのnode_modules/.binにあるtscバイナリを直接実行できる
- npmはパッケージ管理が主目的で、直接バイナリを実行する機能はない

# src folder配下の`.js`ファイルまたは `.jsx`ファイルを全て`.tsx`に変更
```
nameMacBook-Pro project % find src \( -name "*.js" -o -name "*.jsx" \) -exec sh -c 'mv "$1" "${1%.*}.tsx"' _ {} \;
nameMacBook-Pro project % 

```
# Supabaseのインストール
```
nameMacBook-Pro project % npm install @supabase/supabase-js

added 13 packages, and audited 162 packages in 796ms

35 packages are looking for funding
  run `npm fund` for details

2 high severity vulnerabilities

To address issues that do not require attention, run:
  npm audit fix

To address all issues, run:
  npm audit fix --force

Run `npm audit` for details.
nameMacBook-Pro project % 
```
# 
```
nameMacBook-Pro project % touch .env
```
# error
```
nameMacBook-Pro project % npm run dev

> next-project@0.1.0 dev
> next dev

   ▲ Next.js 14.0.4
   - Local:        http://localhost:3000
   - Environments: .env
   - Experiments (use at your own risk):
     · esmExternals

 ✓ Ready in 2s
 ○ Compiling / ...
 ✓ Compiled / in 2.9s (598 modules)
 ⨯ src/components/TodoList.tsx (13:21) @ map
 ⨯ TypeError: Cannot read properties of undefined (reading 'map')
    at TodoList (./src/components/TodoList.tsx:22:33)
  11 |   return (
  12 |     <ul className="space-y-4">
> 13 |       {filteredTodos.map(function (todo: any) {
     |                     ^
  14 |         return <TodoItem key={todo.id} todo={todo} />;
  15 |       })}
  16 |     </ul>
 ⚠ Fast Refresh had to perform a full reload due to a runtime error.
 ⚠ Fast Refresh had to perform a full reload due to a runtime error.
 ✓ Compiled in 314ms (575 modules)
```
- このエラーは、`filteredTodos`が`undefined`または`null`であるため、mapを呼び出そうとすると発生しています。この問題を解決するには、`filteredTodos`が未定義でないことを確認する条件を追加する必要があります。
- `TodoList.tsx`にて、`filteredTodos`が`undefined`である場合に空配列をデフォルト値として使用するように変更します。
  - Array.isArray(filteredTodos):
    - filteredTodosが配列であることを確認します。配列以外の場合はmapをスキップします。
  - デフォルト値を設定:
    - 必要に応じて、呼び出し元コンポーネントで`filteredTodos`の初期値を空配列に設定するのも有効です。


# エラー
```
Unhandled Runtime Error
TypeError: Cannot read properties of undefined (reading 'VITE_SUPABASE_URL')

Source
src/supabase.js (3:20) @ eval

  1 | import { createClient } from '@supabase/supabase-js';
  2 |
> 3 | const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
    |                    ^
  4 | const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
  5 |
  6 | export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```
## エラーの原因
このエラーは、`import.meta.env`がNext.js環境ではサポートされていないためです。`import.meta.env`はViteや他の特定のツールで使用されますが、Next.jsでは環境変数を読み込む方法が異なります。

Next.jsでは、環境変数を使用する場合、環境変数名を**NEXT_PUBLIC_で始める**必要があります。
## `VITE_`プレフィックスを`NEXT_PUBLIC_`に変更する

# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
# 
```

```
